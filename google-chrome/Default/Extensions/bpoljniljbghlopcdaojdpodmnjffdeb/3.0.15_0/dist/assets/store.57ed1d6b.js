import{c as commonjsGlobal,a as bridgePopupBackground,Z as ZonesEvents,f as defineStore,j as ServerType,k as first}from"./popup.71dac307.js";import{s as stop}from"./connection.c490c47b.js";var isArray_1=Array.isArray,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,_root=freeGlobal||freeSelf||Function("return this")(),_Symbol=_root.Symbol,Symbol$4=_Symbol,objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty,nativeObjectToString$1=objectProto$6.toString,symToStringTag$1=Symbol$4?Symbol$4.toStringTag:void 0;var _getRawTag=function(value){var isOwn=hasOwnProperty$5.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{value[symToStringTag$1]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString$1.call(value);return unmasked&&(isOwn?value[symToStringTag$1]=tag:delete value[symToStringTag$1]),result},nativeObjectToString=Object.prototype.toString;var getRawTag=_getRawTag,objectToString=function(value){return nativeObjectToString.call(value)},symToStringTag=_Symbol?_Symbol.toStringTag:void 0;var _baseGetTag=function(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)};var isObjectLike_1=function(value){return null!=value&&"object"==typeof value},baseGetTag$2=_baseGetTag,isObjectLike$2=isObjectLike_1;var isSymbol_1=function(value){return"symbol"==typeof value||isObjectLike$2(value)&&"[object Symbol]"==baseGetTag$2(value)},isArray$4=isArray_1,isSymbol$2=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;var _isKey=function(value,object){if(isArray$4(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol$2(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))};var isObject_1=function(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)},baseGetTag$1=_baseGetTag,isObject$2=isObject_1;var uid,isFunction_1=function(value){if(!isObject$2(value))return!1;var tag=baseGetTag$1(value);return"[object Function]"==tag||"[object GeneratorFunction]"==tag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag},coreJsData=_root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"";var _isMasked=function(func){return!!maskSrcKey&&maskSrcKey in func},funcToString$1=Function.prototype.toString;var isFunction=isFunction_1,isMasked=_isMasked,isObject$1=isObject_1,toSource=function(func){if(null!=func){try{return funcToString$1.call(func)}catch(e){}try{return func+""}catch(e){}}return""},reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$4=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$4.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$4).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var baseIsNative=function(value){return!(!isObject$1(value)||isMasked(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))},getValue=function(object,key){return null==object?void 0:object[key]};var _getNative=function(object,key){var value=getValue(object,key);return baseIsNative(value)?value:void 0},_nativeCreate=_getNative(Object,"create"),nativeCreate$3=_nativeCreate;var _hashClear=function(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0};var _hashDelete=function(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result},nativeCreate$2=_nativeCreate,hasOwnProperty$3=Object.prototype.hasOwnProperty;var _hashGet=function(key){var data=this.__data__;if(nativeCreate$2){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty$3.call(data,key)?data[key]:void 0},nativeCreate$1=_nativeCreate,hasOwnProperty$2=Object.prototype.hasOwnProperty;var nativeCreate=_nativeCreate;var hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=function(key){var data=this.__data__;return nativeCreate$1?void 0!==data[key]:hasOwnProperty$2.call(data,key)},hashSet=function(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this};function Hash$1(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}Hash$1.prototype.clear=hashClear,Hash$1.prototype.delete=hashDelete,Hash$1.prototype.get=hashGet,Hash$1.prototype.has=hashHas,Hash$1.prototype.set=hashSet;var _Hash=Hash$1;var _listCacheClear=function(){this.__data__=[],this.size=0};var eq_1=function(value,other){return value===other||value!=value&&other!=other},eq$1=eq_1;var _assocIndexOf=function(array,key){for(var length=array.length;length--;)if(eq$1(array[length][0],key))return length;return-1},assocIndexOf$3=_assocIndexOf,splice=Array.prototype.splice;var assocIndexOf$2=_assocIndexOf;var assocIndexOf$1=_assocIndexOf;var assocIndexOf=_assocIndexOf;var listCacheClear=_listCacheClear,listCacheDelete=function(key){var data=this.__data__,index=assocIndexOf$3(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)},listCacheGet=function(key){var data=this.__data__,index=assocIndexOf$2(data,key);return index<0?void 0:data[index][1]},listCacheHas=function(key){return assocIndexOf$1(this.__data__,key)>-1},listCacheSet=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this};function ListCache$1(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache$1.prototype.clear=listCacheClear,ListCache$1.prototype.delete=listCacheDelete,ListCache$1.prototype.get=listCacheGet,ListCache$1.prototype.has=listCacheHas,ListCache$1.prototype.set=listCacheSet;var _ListCache=ListCache$1,Map$1=_getNative(_root,"Map"),Hash=_Hash,ListCache=_ListCache,Map=Map$1;var isKeyable=function(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value};var _getMapData=function(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map},getMapData$3=_getMapData;var getMapData$2=_getMapData;var getMapData$1=_getMapData;var getMapData=_getMapData;var mapCacheClear=function(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},mapCacheDelete=function(key){var result=getMapData$3(this,key).delete(key);return this.size-=result?1:0,result},mapCacheGet=function(key){return getMapData$2(this,key).get(key)},mapCacheHas=function(key){return getMapData$1(this,key).has(key)},mapCacheSet=function(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this};function MapCache$1(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache$1.prototype.clear=mapCacheClear,MapCache$1.prototype.delete=mapCacheDelete,MapCache$1.prototype.get=mapCacheGet,MapCache$1.prototype.has=mapCacheHas,MapCache$1.prototype.set=mapCacheSet;var MapCache=MapCache$1;function memoize$1(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize$1.Cache||MapCache),memoized}memoize$1.Cache=MapCache;var memoize=memoize$1;var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,_stringToPath=function(func){var result=memoize(func,(function(key){return 500===cache.size&&cache.clear(),key})),cache=result.cache;return result}((function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,(function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)})),result}));var arrayMap=function(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result},isArray$3=isArray_1,isSymbol$1=isSymbol_1,symbolProto=_Symbol?_Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;var _baseToString=function baseToString$1(value){if("string"==typeof value)return value;if(isArray$3(value))return arrayMap(value,baseToString$1)+"";if(isSymbol$1(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result},baseToString=_baseToString;var isArray$2=isArray_1,isKey=_isKey,stringToPath=_stringToPath,toString=function(value){return null==value?"":baseToString(value)};var _castPath=function(value,object){return isArray$2(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))},isSymbol=isSymbol_1;var _toKey=function(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result},castPath$3=_castPath,toKey$2=_toKey;var _baseGet=function(object,path){for(var index=0,length=(path=castPath$3(path,object)).length;null!=object&&index<length;)object=object[toKey$2(path[index++])];return index&&index==length?object:void 0},getNative=_getNative,_defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}(),defineProperty$1=_defineProperty;var baseAssignValue=function(object,key,value){"__proto__"==key&&defineProperty$1?defineProperty$1(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value},eq=eq_1,hasOwnProperty$1=Object.prototype.hasOwnProperty;var reIsUint=/^(?:0|[1-9]\d*)$/;var _isIndex=function(value,length){var type=typeof value;return!!(length=null==length?9007199254740991:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length},assignValue=function(object,key,value){var objValue=object[key];hasOwnProperty$1.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)},castPath$2=_castPath,isIndex$1=_isIndex,isObject=isObject_1,toKey$1=_toKey;var baseGet=_baseGet,baseSet=function(object,path,value,customizer){if(!isObject(object))return object;for(var index=-1,length=(path=castPath$2(path,object)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey$1(path[index]),newValue=value;if("__proto__"===key||"constructor"===key||"prototype"===key)return object;if(index!=lastIndex){var objValue=nested[key];void 0===(newValue=customizer?customizer(objValue,key,nested):void 0)&&(newValue=isObject(objValue)?objValue:isIndex$1(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object},castPath$1=_castPath;var _basePickBy=function(object,paths,predicate){for(var index=-1,length=paths.length,result={};++index<length;){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath$1(path,object),value)}return result};var _baseHasIn=function(object,key){return null!=object&&key in Object(object)},baseGetTag=_baseGetTag,isObjectLike$1=isObjectLike_1;var baseIsArguments=function(value){return isObjectLike$1(value)&&"[object Arguments]"==baseGetTag(value)},isObjectLike=isObjectLike_1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable,isArguments$2=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var castPath=_castPath,isArguments$1=isArguments$2,isArray$1=isArray_1,isIndex=_isIndex,isLength=function(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991},toKey=_toKey;var baseHasIn=_baseHasIn,hasPath=function(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray$1(object)||isArguments$1(object))};var basePickBy=_basePickBy,hasIn=function(object,path){return null!=object&&hasPath(object,path,baseHasIn)};var _basePick=function(object,paths){return basePickBy(object,paths,(function(value,path){return hasIn(object,path)}))};var _arrayPush=function(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array},isArguments=isArguments$2,isArray=isArray_1,spreadableSymbol=_Symbol?_Symbol.isConcatSpreadable:void 0;var arrayPush=_arrayPush,isFlattenable=function(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])};var _baseFlatten=function baseFlatten$1(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten$1(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result},baseFlatten=_baseFlatten;var flatten_1=function(array){return(null==array?0:array.length)?baseFlatten(array,1):[]};var apply=function(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)},nativeMax=Math.max;var _overRest=function(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}};var constant=function(value){return function(){return value}},defineProperty=_defineProperty,_baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:function(value){return value},nativeNow=Date.now;var setToString$1=function(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=800)return arguments[0]}else count=0;return func.apply(void 0,arguments)}}(_baseSetToString),flatten=flatten_1,overRest=_overRest,setToString=setToString$1;var basePick=_basePick,pick_1=function(func){return setToString(overRest(func,void 0,flatten),func+"")}((function(object,paths){return null==object?{}:basePick(object,paths)}));async function setFavourite(type,region,protocol){await bridgePopupBackground.emit(ZonesEvents.SetFavourite.Name,{type:type,region:region,protocol:protocol})}async function getZones(refreshable=!0){await bridgePopupBackground.emit(ZonesEvents.GetZones.Name,{refreshable:refreshable})}const zonesStore=defineStore({id:"zonesStore",state:()=>({zones:[],favourites:[],current:null,last:null}),actions:{updateServers(eValue){const zones=eValue.filter((iValue=>!(iValue.serverType===ServerType.Free&&!iValue.nodeIsAvailable))).map((iValue=>{var _a;return{...iValue,ping:(null==(_a=this.zones.find((dValue=>dValue.serverType===iValue.serverType&&dValue.regionCode===iValue.regionCode&&dValue.serverProtocol===iValue.serverProtocol)))?void 0:_a.ping)||null}}));this.zones=zones;const filtredZones=this.zones.filter((iValue=>iValue.nodeIsAvailable));if(!filtredZones.length)return this.current=null,void stop();if(this.current){if(filtredZones.some((iValue=>iValue.serverType===this.current.serverType&&iValue.regionCode===this.current.regionCode&&iValue.serverProtocol===this.current.serverProtocol)))return}else if(this.last){if(filtredZones.some((iValue=>iValue.serverType===this.last.serverType&&iValue.regionCode===this.last.regionCode&&iValue.serverProtocol===this.last.serverProtocol)))return void(this.current=this.last)}const firstZone=first(filtredZones);this.setCurrent(pick_1(firstZone,["serverType","serverProtocol","regionCode"]))},updateFavourites(value){this.favourites=value},setCurrent(value){this.current=value,stop(),async function(type,region,protocol){await bridgePopupBackground.emit(ZonesEvents.SetLast.Name,{type:type,region:region,protocol:protocol})}(value.serverType,value.regionCode,value.serverProtocol)},setLast(value){this.last=value},updatePing(eValue){eValue.forEach((iValue=>{const find=this.zones.find((dValue=>dValue.serverType===iValue.serverType&&dValue.regionCode===iValue.regionCode&&dValue.serverProtocol===iValue.serverProtocol));find&&(find.ping=iValue.ping)}))},isFavourite(eValue){return this.favourites.some((iValue=>iValue.serverType===eValue.serverType&&iValue.regionCode===eValue.regionCode&&iValue.serverProtocol===eValue.serverProtocol))}},getters:{getCurrent(){return this.zones.find((value=>{var _a,_b,_c;return value.serverType===(null==(_a=this.current)?void 0:_a.serverType)&&value.regionCode===(null==(_b=this.current)?void 0:_b.regionCode)&&value.serverProtocol===(null==(_c=this.current)?void 0:_c.serverProtocol)}))},getPingRegion(){return this.zones.map((value=>({ping:value.ping,serverType:value.serverType,serverHost:value.serverHost,regionCode:value.regionCode,serverProtocol:value.serverProtocol})))}}});export{getZones as g,setFavourite as s,zonesStore as z};
