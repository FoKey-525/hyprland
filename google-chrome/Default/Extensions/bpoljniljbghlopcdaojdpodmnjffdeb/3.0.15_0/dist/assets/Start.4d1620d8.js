import{_ as _export_sfc,q as defineComponent,r as useTranslation_1,P as ref,J as openBlock,y as createElementBlock,z as createBaseVNode,Q as createBlock,K as Loader,T as toDisplayString,V as unref,W as _imports_0,X as pushScopeId,Y as popScopeId,$ as _imports_0$1,n as notificationStore,a0 as modalStore,u as userStore,a1 as onMounted,x as onBeforeUnmount,B as createVNode,a2 as withCtx,a3 as Button,a4 as normalizeClass,a5 as Transition,a6 as resolveComponent,R as RouterPaths,a7 as withModifiers,a8 as withDirectives,a9 as vShow,aa as Fragment,ab as _sfc_main$2,ac as _imports_0$2,ad as _imports_1,ae as createTextVNode,k as first,af as NotificationType,ag as Type}from"./popup.71dac307.js";import{r as required,m as minLength,a as maxLength,c as common,e as email,u as useVuelidate,b as createI18nMessage}from"./index.esm.4cb2c7eb.js";import{u as useOtp,a as authorization,b as registerUser,l as login,d as restoreUser}from"./user.c5d689ac.js";const _hoisted_1$1={class:"qr-code"},_hoisted_2$1={class:"icon"},_hoisted_3$1={key:1,src:_imports_0,class:"qr"},_hoisted_4$1={class:"info"},_hoisted_5$1={class:"upper"},_hoisted_6$1={class:"bottom"},_hoisted_7$1=(n=>(pushScopeId("data-v-68caa084"),n=n(),popScopeId(),n))((()=>createBaseVNode("img",{src:_imports_0$1,class:"arrow"},null,-1)));var QrCode=_export_sfc(defineComponent({__name:"QrCode",setup(__props,{expose:expose}){const{t:t}=useTranslation_1(),loader=ref(!1);return expose({setLoader:value=>loader.value=value}),(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[loader.value?(openBlock(),createBlock(Loader,{key:0})):(openBlock(),createElementBlock("img",_hoisted_3$1))]),createBaseVNode("div",_hoisted_4$1,[createBaseVNode("div",_hoisted_5$1,toDisplayString(unref(t)("qrCode.login")),1),createBaseVNode("div",_hoisted_6$1,toDisplayString(unref(t)("qrCode.camera")),1)]),_hoisted_7$1]))}}),[["__scopeId","data-v-68caa084"]]);const _withScopeId=n=>(pushScopeId("data-v-72caa6a2"),n=n(),popScopeId(),n),_hoisted_1={class:"start"},_hoisted_2=_withScopeId((()=>createBaseVNode("img",{src:_imports_0$2},null,-1))),_hoisted_3={class:"upper"},_hoisted_4=_withScopeId((()=>createBaseVNode("div",{class:"logo"},[createBaseVNode("img",{src:_imports_1}),createBaseVNode("div",{class:"name"},[createBaseVNode("b",null,"4ebur"),createTextVNode(".net")])],-1))),_hoisted_5={class:"titles"},_hoisted_6={class:"title"},_hoisted_7={class:"upper"},_hoisted_8={class:"bottom"},_hoisted_9={class:"subtitle"},_hoisted_10={class:"bottom"},_hoisted_11={class:"buttons"},_hoisted_12={class:"enter-key"},_hoisted_13={class:"back"},_hoisted_14={class:"info"},_hoisted_15={class:"title"},_hoisted_16={class:"subtitle"},_hoisted_17={class:"form"},_hoisted_18={class:"info"},_hoisted_19={class:"title"},_hoisted_20={class:"subtitle"},_hoisted_21={class:"form"};var Start=_export_sfc(defineComponent({__name:"Start",setup(__props){const{t:t}=useTranslation_1(),notification=notificationStore(),modal=modalStore(),user=userStore(),loading=ref(!1),loginModal=ref(!1),page=ref("login"),userId=ref(""),email$1=ref(""),$otpButton=ref(null),$registerButton=ref(null),$loginButton=ref(null),$loginInput=ref(null),$restoreInput=ref(null),$restoreButton=ref(null),$qrcode=ref(null),withI18nMessage=createI18nMessage({t:t}),rulesLogin={userId:{required:withI18nMessage(required,{messagePath:()=>"start.enterKey.validation.idUser.required"}),minLength:withI18nMessage(minLength(16),{messagePath:()=>"start.enterKey.validation.idUser.minLength"}),maxLength:withI18nMessage(maxLength(16),{messagePath:()=>"start.enterKey.validation.idUser.maxLength"}),numbers:withI18nMessage(common.regex(/^\d+$/),{messagePath:()=>"start.enterKey.validation.idUser.numbers"})}},rulesRestore={email:{required:withI18nMessage(required,{messagePath:()=>"start.enterKey.validation.email.required"}),email:withI18nMessage(email,{messagePath:()=>"start.enterKey.validation.email.email"})}},vLogin$=useVuelidate(rulesLogin,{userId:userId}),vRestore$=useVuelidate(rulesRestore,{email:email$1}),setPage=value=>page.value=value,changeUserId=value=>userId.value=value,changeEmail=value=>email$1.value=value,setLoginModal=value=>{loginModal.value=value,changeUserId(""),changeEmail("")},registerUser$1=async()=>{loading.value=!0,$registerButton.value.setLoader(!0);const registerResult=await registerUser();if(!registerResult)return loading.value=!1,void $registerButton.value.setLoader(!1);await login(registerResult),loading.value=!1,$registerButton.value.setLoader(!1)},openModalCode=()=>modal.open(Type.CODE,user.receivingCode,user.receivingCode);let interval;return onMounted((()=>{interval=setInterval((()=>(async()=>{await useOtp(user.receivingCode)&&(modal.close(),loading.value=!0,$qrcode.value.setLoader(!0),await authorization(),loading.value=!1,$qrcode.value.setLoader(!1))})()),1e3)})),onBeforeUnmount((()=>{clearInterval(interval)})),(_ctx,_cache)=>{const _component_router_link=resolveComponent("router-link");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",{class:normalizeClass(["content",{disable:loading.value}])},[createVNode(_component_router_link,{class:"settings",to:unref(RouterPaths).SETTINGS_APPLICATION},{default:withCtx((()=>[_hoisted_2])),_:1},8,["to"]),createBaseVNode("div",_hoisted_3,[_hoisted_4,createBaseVNode("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(unref(t)("start.greetings.welcome")),1),createBaseVNode("div",_hoisted_8,toDisplayString(unref(t)("start.greetings.in"))+" 4ebur.net ",1)]),createBaseVNode("div",_hoisted_9,toDisplayString(unref(t)("start.greetings.description")),1)])]),createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[createVNode(Button,{ref_key:"$registerButton",ref:$registerButton,text:unref(t)("start.buttons.newUser"),onClick:registerUser$1},null,8,["text"]),createVNode(Button,{ref_key:"$otpButton",ref:$otpButton,text:unref(t)("start.buttons.haveKey"),"is-dark":!0,onClick:_cache[0]||(_cache[0]=$event=>setLoginModal(!0))},null,8,["text"])]),createVNode(QrCode,{ref_key:"$qrcode",ref:$qrcode,onClick:withModifiers(openModalCode,["stop"])},null,8,["onClick"])])],2),createVNode(Transition,{name:"modal"},{default:withCtx((()=>[withDirectives(createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createBaseVNode("div",{class:"btn",onClick:_cache[1]||(_cache[1]=$event=>setLoginModal(!1))},toDisplayString(unref(t)("start.enterKey.cancel")),1)]),"login"===page.value?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",_hoisted_14,[createBaseVNode("div",_hoisted_15,toDisplayString(unref(t)("start.enterKey.titlesLogin.title")),1),createBaseVNode("div",_hoisted_16,toDisplayString(unref(t)("start.enterKey.titlesLogin.subtitle")),1)]),createBaseVNode("div",_hoisted_17,[createVNode(_sfc_main$2,{ref_key:"$loginInput",ref:$loginInput,image:"inputs/key.svg",value:userId.value,placeholder:unref(t)("start.enterKey.inputKey"),mask:{mask:"#### #### #### ####"},onChangeValue:changeUserId},null,8,["value","placeholder"]),createVNode(Button,{ref_key:"$loginButton",ref:$loginButton,text:unref(t)("start.enterKey.login"),onClick:_cache[2]||(_cache[2]=$event=>(async value=>{const licenseKey=value||userId.value.trim();if(!value&&(vLogin$.value.$touch(),vLogin$.value.$error)){const error=first(vLogin$.value.$errors);return notification.add(NotificationType.ERROR,error.$message,!1),void(vLogin$.value.userId.$error&&$loginInput.value.addAnimation("wave-error"))}loading.value=!0,$loginButton.value.setLoader(!0);const result=await login(licenseKey);loading.value=!1,$loginButton.value.setLoader(!1),result||$loginInput.value.addAnimation("wave-error")})())},null,8,["text"]),createBaseVNode("div",{class:"text-button",onClick:_cache[3]||(_cache[3]=$event=>setPage("restore"))},toDisplayString(unref(t)("start.enterKey.control.restore")),1)])],64)):(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,toDisplayString(unref(t)("start.enterKey.titlesRestore.title")),1),createBaseVNode("div",_hoisted_20,toDisplayString(unref(t)("start.enterKey.titlesRestore.subtitle")),1)]),createBaseVNode("div",_hoisted_21,[createVNode(_sfc_main$2,{ref_key:"$restoreInput",ref:$restoreInput,image:"inputs/key.svg",value:email$1.value,placeholder:unref(t)("start.enterKey.inputEmail"),onChangeValue:changeEmail},null,8,["value","placeholder"]),createVNode(Button,{ref_key:"$restoreButton",ref:$restoreButton,text:unref(t)("start.enterKey.restore"),onClick:_cache[4]||(_cache[4]=$event=>(async()=>{if(email$1.value=email$1.value.trim(),vRestore$.value.$touch(),vRestore$.value.$error){const error=first(vRestore$.value.$errors);return notification.add(NotificationType.ERROR,error.$message,!1),void(vRestore$.value.email.$error&&$restoreInput.value.addAnimation("wave-error"))}loading.value=!0,$restoreButton.value.setLoader(!0),await restoreUser(email$1.value),loading.value=!1,$restoreButton.value.setLoader(!1)})())},null,8,["text"]),createBaseVNode("div",{class:"text-button",onClick:_cache[5]||(_cache[5]=$event=>setPage("login"))},toDisplayString(unref(t)("start.enterKey.control.login")),1)])],64))],512),[[vShow,loginModal.value]])])),_:1})])}}}),[["__scopeId","data-v-72caa6a2"]]);export{Start as default};
